---
title: VB6_æŒ‰é’®å•å‡»æ¶ˆæ¯å¤„ç†
date: 2020-04-28
description:  ä¸€ä¸ªç•Œé¢æœ‰æ— æ•°ä¸ªæŒ‰é’®ã€éƒ¨åˆ†æ˜¯æ•°ç»„ï¼Œéƒ¨åˆ†ä¸æ˜¯ã€‘ï¼Œä¸åŒåå­—ï¼Œå¦‚ä½•å†™ä¸€ä¸ªé€šç”¨çš„å‡½æ•°æ¥è¯†åˆ«ç‚¹å‡»å“ªä¸ªæŒ‰é’®ï¼Œè¿”å›å®ƒçš„åå­—å’Œåºå·ï¼Ÿ
draft: false
hideToc: false
enableToc: true
enableTocContent: true
author: lin
authorEmoji: ğŸ¤£
type: theme
tags:
- VB
#ç±»åˆ«
#categories:
#- themes
#ç³»åˆ—
#eries:  
#- Themes Guide
---
æ¨¡å—ä»£ç ï¼š
```visual basic
Option Explicit
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
Public Declare Function GetWindow Lib "user32" (ByVal hwnd As Long, ByVal wCmd As Long) As Long
Public Declare Function GetClassName Lib "user32" Alias "GetClassNameA" (ByVal hwnd As Long, ByVal lpClassName As String, ByVal nMaxCount As Long) As Long
Public lpPrevWndProc As Long
Public Declare Function CallWindowProc Lib "user32" Alias "CallWindowProcA" (ByVal lpPrevWndFunc As Long, ByVal hwnd As Long, ByVal Msg As Long, ByVal wParam As Long, ByVal lParam As Long) As Long
Public Declare Function SetWindowLong Lib "user32" Alias "SetWindowLongA" (ByVal hwnd As Long, ByVal nIndex As Long, ByVal dwNewLong As Long) As Long

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''    - By é£é™µ - InkHin.com {ä½ ä½ ä½ ï¼å±…ç„¶å¤¹å¸¦ç§è´§ï¼}  - '''''''''''
        '''''''''''''    ä¾›å¹¿å¤§äººæ°‘ç¾¤ä¼—ç ”ç©¶å­¦ä¹ ä½¿ç”¨ éšä¾¿æŠ„   '''''''''''''''''

''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
Public Command() As Long  'æŒ‰é’®ç»„

Public Function è·å–æ§ä»¶å(ByRef YourControls As Object, Find As Long) As String
Dim kj As Control
For Each kj In YourControls
On Error Resume Next
    If kj.hwnd = Find Then
        è·å–æ§ä»¶å = kj.Name
'éæ•°ç»„æ§ä»¶ç±»å‹è¯»å–è¯¥é¡¹å±æ€§ä¼šæŠ¥é”™éæ•°ç»„ emmæš‚æ—¶ä¹Ÿæ²¡æœ‰æƒ³åˆ°æ›´å¥½çš„æ–¹æ³•åªèƒ½åŠ ä¸ªé”™è¯¯å¤„ç†äº†
        è·å–æ§ä»¶å = è·å–æ§ä»¶å & kj.Index
        Exit For
    End If
Next
End Function
Public Sub æ•°ç»„_è·å–çª—ä½“æ‰€æœ‰æŒ‰é’®(ByVal hwnd As Long, ByRef Value() As Long)
Dim start As Long
start = GetWindow(GetWindow(hwnd, 5), 0)
Dim Now As Long 'å®æ—¶å¥æŸ„
Dim s As String 'IpClassName
 'Dim Value() as Long 'å‚¨å­˜æŒ‰é’®å¥æŸ„
Now = start
Dim i As Integer
Do While Now <> 0 'éå†æ§ä»¶
    s = String(256, Chr(0)): GetClassName Now, s, 255
    s = Replace(s, Chr(0), "")
    'å¤„ç†ä»£ç 
    If s = "ThunderCommandButton" Then
                ReDim Preserve Value(i)
                Value(i) = Now
                i = i + 1
    End If
    æ•°ç»„_è·å–çª—ä½“æ‰€æœ‰æŒ‰é’® Now, Value()
    Now = GetWindow(Now, 2)
    If Now = start Then Exit Do
Loop
End Sub
'æ¶ˆæ¯å¤„ç†
Public Function WindowProc(ByVal hw As Long, ByVal uMsg As Long, ByVal wParam As Long, ByVal lParam As Long) As Long
 If uMsg = &H201 And wParam = &H1 Then
    Debug.Print "æ§ä»¶ï¼š" + è·å–æ§ä»¶å(Form1.Controls, hw) + " è¢«å·¦é”®å•å‡»"
 End If

 WindowProc = CallWindowProc(lpPrevWndProc, hw, uMsg, wParam, lParam)
End Function

```

çª—ä½“ä»£ç ï¼š

```visual basic
Private Sub Form_Load()
Call æ•°ç»„_è·å–çª—ä½“æ‰€æœ‰æŒ‰é’®(Me.hwnd, Command())
Init
End Sub

Private Sub Init()
Dim i As Integer
For i = 0 To UBound(Command())
   lpPrevWndProc = SetWindowLong(Command(i), -4, AddressOf WindowProc)
Next
End Sub
```

ä½¿ç”¨æ•ˆæœï¼š

![](https://ae01.alicdn.com/kf/Hf3434970e08d4bd98ff1bc77307dcfd1G.jpg)