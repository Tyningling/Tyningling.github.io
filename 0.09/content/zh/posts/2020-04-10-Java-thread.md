---
title: Java å¤šçº¿ç¨‹ç¼–ç¨‹
date: 2020-04-10
description: Java å¤šçº¿ç¨‹
draft: false
hideToc: false
enableToc: true
enableTocContent: true
author: lin
authorEmoji: ğŸ¤£
type: theme
tags:
- Java
#ç±»åˆ«
categories:
- Java
#ç³»åˆ—
image: https://y.gtimg.cn/music/photo_new/T002R300x300M000003Mowrk2QZgq5_2.jpg
---



## è¿›ç¨‹ä¸çº¿ç¨‹

### è¿›ç¨‹

**è¿›ç¨‹**ï¼ˆProcessï¼‰æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯[æ“ä½œç³»ç»Ÿ]ç»“æ„çš„åŸºç¡€ã€‚åœ¨æ—©æœŸé¢å‘è¿›ç¨‹è®¾è®¡çš„è®¡ç®—æœºç»“æ„ä¸­ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºçš„åŸºæœ¬æ‰§è¡Œå®ä½“ï¼›åœ¨å½“ä»£é¢å‘çº¿ç¨‹è®¾è®¡çš„è®¡ç®—æœºç»“æ„ä¸­ï¼Œè¿›ç¨‹æ˜¯çº¿ç¨‹çš„å®¹å™¨ã€‚ç¨‹åºæ˜¯æŒ‡ä»¤ã€æ•°æ®åŠå…¶ç»„ç»‡å½¢å¼çš„æè¿°ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºçš„å®ä½“ã€‚

### çº¿ç¨‹

**çº¿ç¨‹**ï¼ˆThreadï¼‰æ˜¯[æ“ä½œç³»ç»Ÿ]èƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ã€‚å®ƒè¢«åŒ…å«åœ¨[è¿›ç¨‹]ä¹‹ä¸­ï¼Œæ˜¯[è¿›ç¨‹]ä¸­çš„å®é™…è¿ä½œå•ä½ã€‚ä¸€æ¡çº¿ç¨‹æŒ‡çš„æ˜¯[è¿›ç¨‹]ä¸­ä¸€ä¸ªå•ä¸€é¡ºåºçš„æ§åˆ¶æµï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¹¶å‘å¤šä¸ªçº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚

### ä¸»çº¿ç¨‹

**ä¸»çº¿ç¨‹** (Main Threadï¼‰æ˜¯å½“ä¸€ä¸ªç¨‹åºå¯åŠ¨æ—¶ï¼Œå°±æœ‰ä¸€ä¸ªè¿›ç¨‹è¢«æ“ä½œç³»ç»Ÿï¼ˆOSï¼‰åˆ›å»ºï¼Œä¸æ­¤åŒæ—¶ä¸€ä¸ªçº¿ç¨‹ä¹Ÿç«‹åˆ»è¿è¡Œ,å› ä¸ºå®ƒæ˜¯ç¨‹åºå¼€å§‹æ—¶å°±æ‰§è¡Œçš„ï¼Œå¦‚æœä½ éœ€è¦å†åˆ›å»ºçº¿ç¨‹ï¼Œé‚£ä¹ˆåˆ›å»ºçš„çº¿ç¨‹å°±æ˜¯è¿™ä¸ªä¸»çº¿ç¨‹çš„å­çº¿ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹è‡³å°‘éƒ½æœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼

### å­çº¿ç¨‹
**å­çº¿ç¨‹**   (Sub Thread)  åŒä¸Šï¼Œå³è¢«è¿›ç¨‹åˆ›å»ºçš„é™¤ä¸»çº¿ç¨‹å¤–çš„çº¿ç¨‹ã€‚

## åˆ›å»ºå­çº¿ç¨‹

Javaä¸­ï¼Œåˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹ä¸€èˆ¬æ¶‰åŠåˆ°`java.lang.Thread`ç±»å’Œ`java.lang.Runnable`æ¥å£ã€‚

Thread å³çº¿ç¨‹ç±»ï¼Œæ¯å½“åˆ›å»ºä¸€ä¸ªThreadå¯¹è±¡å³äº§ç”Ÿä¸€ä¸ªæ–°çš„å­çº¿ç¨‹ã€‚

çº¿ç¨‹æ‰€è¿è¡Œçš„ä»£ç ç”±`Runnable`æ¥å£çš„`run()` æ–¹æ³•å®ç°ã€‚

æˆ‘ä»¬éœ€è¦å¯¹`run()` è¿›è¡Œé‡å†™ï¼Œä»¥é©±åŠ¨å­çº¿ç¨‹ã€‚`run()`æ–¹æ³•ä¹Ÿè¢«ç§°ä¸ºçº¿ç¨‹ä½“ã€‚

ä¸‹é¢å°†ä»‹ç»å‡ ç§å…³äºåˆ›å»º`Thread`çš„åº”ç”¨ç¤ºä¾‹ã€‚

### è·å–ä¸»çº¿ç¨‹

```java
// è·å–ä¸»çº¿ç¨‹ç¤ºä¾‹

Thread mainThread = Thread.currentThread();

System.out.println("ä¸»çº¿ç¨‹å : " + mainThread.getName()) ;
```

### ä½¿ç”¨çº¿ç¨‹ç±»

 åœ¨ä¸€ä¸ªç±»ä¸­ä½¿ç”¨`Runnableæ¥å£`ï¼Œåœ¨è¿™ä¸ªç±»ä¸­é‡å†™æ¥å£çš„`run()`.

```java
//currentThread.getName()  è¿™ä¸ªæ–¹æ³• å°†è¿”å›å­çº¿ç¨‹çš„åå­—[String]ã€‚
//Thread.sleep(long millis) è¿™ä¸ªæ˜¯Threadç±»çš„é™æ€æ–¹æ³•ï¼Œå°†ä½¿å½“å‰çº¿ç¨‹è¿›å…¥ä¼‘çœ ã€‚
//æç¤ºï¼š å¯ä»¥æ³¨é‡Šæ‰sleep æ¥è§‚å¯ŸåŒºåˆ«
public class Runner implements Runnable {
    @Override
    public void run() {
        //æ‰“å°æ¬¡æ•°å’Œçº¿ç¨‹åå­—
        for( int i = 0 ;i < 10; i++) {
            System.out.printf("ç¬¬ %d æ¬¡æ‰§è¡Œ - %s \n" ,i ,Thread.currentThread().getName()); 

            try{
            //éšæœºç”Ÿæˆæ—¶é—´
                long sleepTime = (long)(1000 * Math.random());
                Thread.sleep (sleepTime);
            //çº¿ç¨‹ä¼‘çœ 
            } catch (InterruptedException e) { }


        }
        //çº¿ç¨‹æ‰§è¡Œç»“æŸ
        System.out.println("æ‰§è¡Œå®Œæˆ" + Thread.currentThread().getName());
    }
}
```

```java
/**
	æ‰€ä½¿ç”¨çš„çš„æ˜¯Threadç±»ä¸­çš„è¿™ä¸¤ä¸ªæ„é€ æ–¹æ³•ã€‚
	Thread(Runnable target);
	Thread(Runnable target , String Name);
	start(); å­çº¿ç¨‹è°ƒæ•´åˆ°å¯è¿è¡ŒçŠ¶æ€
**/
//è°ƒç”¨ç¤ºä¾‹
Thread t1 = new Thread(new Runner());
t1.start();

Thread t2 = new Thread(new Runner(), "Lucky girl");
t2.start();
```

### ç»§æ‰¿çº¿ç¨‹ç±»

Threadç±»å…¶å®ä¹Ÿå®ç°äº†`Runnable æ¥å£`ï¼Œæ‰€ä»¥`Thread`ç±»ä¹Ÿå¯ä»¥ä½œä¸ºçº¿ç¨‹æ‰§è¡Œå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®©ç±»ç»§æ‰¿ `Thread`æ¥é‡å†™`run()`æ–¹æ³•æ¥åˆ›å»ºå­çº¿ç¨‹ã€‚

```java
public class Luckygirl extends Thread {
    // ç»§æ‰¿çº¿ç¨‹ç±»
    public Luckygirl(){
        super();
    }
    //æ„é€ 
    public Luckygirl(String name){
        super(name);
    }
  
    @Override
    public void run() {
        for (int i = 0 ; i<10 ; i++){
            System.out.printf("ç¬¬%dæ¬¡æ‰§è¡Œ - %s \n" , i , super.getName());

            try{
                //éšæœºç”Ÿæˆæ—¶é—´
                long sleepTime = (long)(1000 * Math.random());
                Thread.sleep (sleepTime);
                //çº¿ç¨‹ä¼‘çœ 
            } catch (InterruptedException e) { }
        }
        //çº¿ç¨‹æ‰§è¡Œç»“æŸ
        System.out.println("æ‰§è¡Œå®Œæˆ" + Thread.currentThread().getName());
    }
}
```

```Java
//è°ƒç”¨ç¤ºä¾‹
Thread t1 = new Luckygirl();
t1.start();

Thread t2 = new Luckygirl("Lucky girl");
t2.start();
```

### åŒ¿åå†…éƒ¨ç±»

å¦‚æœçº¿ç¨‹ä½“çš„ä»»åŠ¡å¹¶ä¸å¤šï¼Œæˆ‘ä»¬å®åœ¨æ²¡æœ‰å¿…è¦éƒ½ç»™å®ƒå•ç‹¬å†™ä¸€ä¸ªç±»ã€‚å¯ä»¥ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»æˆ–Lambdaè¡¨è¾¾å¼ç›´æ¥å®ç°Runnableæ¥å£ã€‚

```Java
// åŒ¿åå†…éƒ¨ç±»ä½¿ç”¨ç¤ºä¾‹
public static void main(String [] args ) {
Thread t1 = new Thread( new Runnable(){
    @Override
    public void run() {
        for(int i = 0 ;i<10 ; i++){
            //æ‰“å°æ¬¡æ•°å’Œçº¿ç¨‹çš„åå­—
            System.out.printf("ç¬¬ %d æ¬¡ æ‰§è¡Œ - %s\n",i,Thread.currentThread().getName());
            try{
                long sleepTime = (long) (1000* Math.random());
                Thread.sleep(sleepTime);
            }catch(InterruptedException e){}
        }
        System.out.printf("æ‰§è¡Œå®Œæˆï¼ " + Thread.currentThread().getName());
    }
},
"Luck girl");
t1.start();
}
```

### Lambdaä¼ å‚

```java
// ä½¿ç”¨Lambdaè¡¨è¾¾å¼ä¼ é€’Runnableå‡½æ•°å‚æ•°
Thread t2 = new Thread(() -> {
    for (int i = 0; i < 10; i++) {
        //æ‰“å°æ¬¡æ•°å’Œçº¿ç¨‹çš„åå­—
        System.out.printf("ç¬¬ %d æ¬¡ æ‰§è¡Œ - %s\n", i, Thread.currentThread().getName());
        try {
            long sleepTime = (long) (1000 * Math.random());
            Thread.sleep(sleepTime);
        } catch (InterruptedException e) {
        }
    }
    System.out.printf("æ‰§è¡Œå®Œæˆï¼ " + Thread.currentThread().getName());
},
"Luck girl");
t2.start();
```

## çº¿ç¨‹çŠ¶æ€

[Java]ä¸­çš„çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¤§ä½“å¯åˆ†ä¸º5ç§çŠ¶æ€ã€‚

1. **æ–°å»º(NEW)**ï¼šæ–°åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚

2. **å°±ç»ª(RUNNABLE)**ï¼šçº¿ç¨‹å¯¹è±¡åˆ›å»ºåï¼Œå…¶ä»–çº¿ç¨‹(æ¯”å¦‚mainçº¿ç¨‹ï¼‰è°ƒç”¨äº†è¯¥å¯¹è±¡çš„start()æ–¹æ³•ã€‚è¯¥çŠ¶æ€çš„çº¿ç¨‹ä½äºå¯è¿è¡Œçº¿ç¨‹æ± ä¸­ï¼Œç­‰å¾…è¢«çº¿ç¨‹è°ƒåº¦é€‰ä¸­ï¼Œè·å–cpu çš„ä½¿ç”¨æƒ ã€‚

3. **è¿è¡Œ(RUNNING)**ï¼šå¯è¿è¡ŒçŠ¶æ€(runnable)çš„çº¿ç¨‹è·å¾—äº†cpu æ—¶é—´ç‰‡ï¼ˆtimesliceï¼‰ ï¼Œæ‰§è¡Œç¨‹åºä»£ç ã€‚
4. **é˜»å¡(BLOCKED)**ï¼šé˜»å¡çŠ¶æ€æ˜¯æŒ‡çº¿ç¨‹å› ä¸ºæŸç§åŸå› æ”¾å¼ƒäº†cpu ä½¿ç”¨æƒï¼Œä¹Ÿå³è®©å‡ºäº†cpu timesliceï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚ç›´åˆ°çº¿ç¨‹è¿›å…¥å¯è¿è¡Œ(runnable)çŠ¶æ€ï¼Œæ‰æœ‰æœºä¼šå†æ¬¡è·å¾—cpu timeslice è½¬åˆ°è¿è¡Œ(running)çŠ¶æ€ã€‚é˜»å¡çš„æƒ…å†µåˆ†ä¸‰ç§ï¼š 
> (ä¸€). ç­‰å¾…é˜»å¡ï¼šè¿è¡Œ(running)çš„çº¿ç¨‹æ‰§è¡Œo.wait()æ–¹æ³•ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—(waitting queue)ä¸­ã€‚
> (äºŒ). åŒæ­¥é˜»å¡ï¼šè¿è¡Œ(running)çš„çº¿ç¨‹åœ¨è·å–å¯¹è±¡çš„åŒæ­¥é”æ—¶ï¼Œè‹¥è¯¥åŒæ­¥é”è¢«åˆ«çš„çº¿ç¨‹å ç”¨ï¼Œåˆ™JVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥é”æ± (lock pool)ä¸­ã€‚
> (ä¸‰). å…¶ä»–é˜»å¡ï¼šè¿è¡Œ(running)çš„çº¿ç¨‹æ‰§è¡ŒThread.sleep(long ms)æˆ–t.join()æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºäº†I/Oè¯·æ±‚æ—¶ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹ç½®ä¸ºé˜»å¡çŠ¶æ€ã€‚å½“sleep()çŠ¶æ€è¶…æ—¶ã€join()ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ã€æˆ–è€…I/Oå¤„ç†å®Œæ¯•æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å¯è¿è¡Œ(runnable)çŠ¶æ€ã€‚

5. **æ­»äº¡(DEAD)**ï¼šçº¿ç¨‹`run()ã€main()` æ–¹æ³•æ‰§è¡Œç»“æŸï¼Œæˆ–è€…å› å¼‚å¸¸é€€å‡ºäº†`run()`æ–¹æ³•ï¼Œåˆ™è¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚æ­»äº¡çš„çº¿ç¨‹ä¸å¯å†æ¬¡å¤ç”Ÿã€‚

## çº¿ç¨‹ç®¡ç†

### ä¼˜å…ˆçº§

 çº¿ç¨‹çš„è°ƒåº¦ç¨‹åºæä¾›çº¿ç¨‹å†³å®šæ¯æ¬¡çº¿ç¨‹åº”å½“ä½•æ—¶è¿è¡Œï¼ŒJavaæä¾›äº†10ç§ä¼˜å…ˆçº§ï¼Œåˆ†åˆ«ç”¨1~10 çš„æ•´æ•°è¡¨ç¤ºï¼Œæä¾›äº†æœ€é«˜   `MAX_PRIORITY = 10` ã€æœ€ä½ `MIN_PRIORITY = 1`ã€é»˜è®¤ `NORM_PRIORITY = 5` ä¸‰ç§ã€‚

Thread ç±»æä¾›äº† `setPriority(int newPriority)`æ–¹æ³•ç”¨ä»¥è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œé€šè¿‡ `getPriority()`æ–¹æ³•å¯ä»¥è·å¾—çº¿ç¨‹ä¼˜å…ˆçº§ã€‚

```java
//ç¤ºä¾‹ï¼š

public static void main(String [] args){
        Thread t1 = new Thread(new Runner());
        t1.setPriority(Thread.MAX_PRIORITY); //level 10
        t1.start();

        Thread t2 = new Thread(new Runner(),"Lucky girl");
        t2.setPriority(Thread.MIN_PRIORITY); //level 1
        t2.start();
    }
    //é™æ€å†…éƒ¨ç±»
    public static class Runner implements Runnable {
        @Override
        public void run() {
            //æ‰“å°æ¬¡æ•°å’Œçº¿ç¨‹åå­—
            for( int i = 0 ;i < 10; i++) {
                System.out.printf("ç¬¬ %d æ¬¡æ‰§è¡Œ - %s \n" ,i ,Thread.currentThread().getName());

                try{
                    //éšæœºç”Ÿæˆä¼‘çœ æ—¶é—´
                    long sleepTime = (long)(1000 * Math.random());
                    Thread.sleep (sleepTime);
                    //çº¿ç¨‹ä¼‘çœ 
                } catch (InterruptedException e) { }
            }
            //çº¿ç¨‹æ‰§è¡Œç»“æŸ
            System.out.println("æ‰§è¡Œå®Œæˆ" + Thread.currentThread().getName());
        }
    }
}
```

### ç­‰å¾…ç»“æŸ

åœ¨çº¿ç¨‹çŠ¶æ€-é˜»å¡çŠ¶æ€ä¸­æœ‰æåŠåˆ°`join()`è¿™ä¸ªæ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹è°ƒç”¨t1çº¿ç¨‹çš„`join()`æ–¹æ³•ï¼Œåˆ™ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰å¾…t1çš„çº¿ç¨‹ä»»åŠ¡ç»“æŸï¼Œå¦‚æœt1çº¿ç¨‹ç»“æŸæˆ–ç­‰å¾…è¶…æ—¶ï¼Œåˆ™å½“å‰çº¿ç¨‹å›åˆ°å°±ç»ªçŠ¶æ€ã€‚

```java
public class HelloWorld {
    static int value = 0;
    public static void main(String [] args) throws InterruptedException{
    Thread t1 = new Thread(() -> {
        System.out.println(" Lucky grilï¼ï¼ï¼ï¼");
        for(int i = 0; i < 2; i++){
            System.out.println("Lucky gril å†²å†²å†²ï¼");
            value = value +1;
        }
        System.out.println(" Lucky gril æ¯”èµ›èƒœåˆ©ï¼");
      
    },"Lucky gril");
       t1.start();
				//è§‚å¯Ÿ å˜é‡-Value
        //å‡è®¾ä¸ä½¿ç”¨joinæˆ–è€…sleepä¼‘çœ ç­‰æ–¹å¼è®©ä¸»çº¿ç¨‹å»¶è¿Ÿåˆ°å­çº¿ç¨‹ç»“æŸï¼Œåˆ™ä¸»çº¿ç¨‹å°†ä¼šè¿”å›0ï¼Œå› ä¸ºå…¶æ²¡æœ‰æƒé™å¾—åˆ°valueçš„å€¼ ä¹Ÿå°±æ˜¯çº¿ç¨‹é˜»å¡ç°è±¡ã€‚

       //t1.join(0);
       //t1.sleep(1000);

        System.out.println("Value  = " + value);
        System.out.println("Lucky gril ä¸‡å²ï¼ï¼ï¼ï¼");
    }
}
```

### è®©æ­¥

Thread ç±»æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•`yield()`ï¼Œè°ƒç”¨`yield()` èƒ½å¤Ÿä½¿å½“å‰çº¿ç¨‹ç»™å…¶å®ƒçº¿ç¨‹è®©æ­¥ï¼Œä½†å®ƒåªç»™ç›¸åŒä¼˜å…ˆçº§æˆ–æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹æä¾›æœºä¼šè¿è¡Œã€‚å®ƒå’Œ`sleep`çœ‹èµ·æ¥å¾ˆç±»ä¼¼ï¼Œä½†æ˜¯`sleep`ä¸è®ºå…¶å®ƒçº¿ç¨‹ä»»ä½•ç­‰çº§éƒ½ä¼šæœ‰æœºä¼šè¿è¡Œï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œ`sleep`å¯ä»¥æ§åˆ¶æ—¶é—´ï¼Œä½†`yield()`å´ä¸èƒ½ï¼Œä»”ç»†è§‚å¯Ÿè¾“å‡ºç»“æœï¼Œå°±å¯ä»¥å‘ç°è¿™ä¸ªç‰¹ç‚¹ã€‚

```java
public class Runner implements Runnable {
    @Override
    public void run() {
        for(int i = 0;i<10;i++)
        {
            //æ‰“å°æ¬¡æ•°å’Œçº¿ç¨‹çš„åå­—
            System.out.printf("ç¬¬%dæ¬¡æ‰§è¡Œ - %s \n",i,Thread.currentThread().getName());
            System.out.printf(Thread.currentThread().getName() + "ï¼šæˆ‘ç´¯äº†ï¼Œä½ å…ˆå¸®æˆ‘é¡¶ä¸€ä¸‹ã€‚\n" );
            Thread.yield();
            /** if(Thread.currentThread().getName().equals("Lucky girl"))
            Thread.yield(); **/
        }
        //çº¿ç¨‹æ‰§è¡Œç»“æŸ
        System.out.println("æ‰§è¡Œå®Œæˆï¼" + Thread.currentThread().getName());
    }

}
```

```java
public class HelloWorld {
    public static void main(String[] args) {
        Thread t1 = new Thread(new Runner(), "Lucky girl");
        t1.start();

        Thread t2 = new Thread(new Runner());
        t2.start();
    }
}
```

### åœæ­¢

***<u>è™½ç„¶Threadæä¾›äº†`stop()`çš„æ–¹æ³•ï¼Œä½†å®ƒå·²ç»ä¸è¢«æ¨èä½¿ç”¨ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•æœ‰æ—¶ä¼šå¼•å‘ä¸¥é‡çš„ç³»ç»Ÿæ•…éšœï¼Œç±»ä¼¼çš„è¿˜æœ‰ `suspend()` å’Œ `resume()`æŒ‚æœºæ–¹æ³•ã€‚Javaç°åœ¨æ¨èçš„åšæ³•å°±æ˜¯é‡‡ç”¨æœ¬ä¾‹çš„ç»“æŸå˜é‡æ–¹å¼ã€‚</u>***

çº¿ç¨‹ä½“ä¸­çš„runæ–¹æ³•å°†ç»“æŸï¼Œçº¿ç¨‹å°±ä¼šè¿›å…¥æ­»äº¡çŠ¶æ€ï¼Œçº¿ç¨‹ä¾¿åœæ­¢äº†ï¼Œä½†æ˜¯æœ‰äº›ä¸šåŠ¡æ¯”è¾ƒå¤æ‚ï¼Œä¾‹å¦‚æƒ³å¼€å‘ä¸€ä¸ªä¸‹è½½ç¨‹åºï¼Œæ¯éš”ä¸€æ®µæ‰§è¡Œä¸‹è½½ä»»åŠ¡ï¼Œä¸‹è½½ä»»åŠ¡ä¸€èˆ¬ä¼šç”±å­çº¿ç¨‹æ‰§è¡Œï¼Œä¼‘çœ ä¸€æ®µæ—¶é—´å†æ‰§è¡Œã€‚ è¿™ä¸ªä¸‹è½½å­çº¿ç¨‹å°±ä¼šæœ‰ä¸€ä¸ªæ­»å¾ªç¯ï¼Œä¸ºäº†èƒ½å¤Ÿåœæ­¢å­çº¿ç¨‹ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªç»“æŸå˜é‡ã€‚

```java
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;

public class HelloWorld {
    //æƒ³çº¿ç¨‹è¿›å…¥æ­»äº¡çŠ¶æ€ åªéœ€è¦è®©RUNæ–¹æ³•ç»“æŸï¼Œè™½ç„¶Threadæä¾›äº†stop()ï¼Œä½†æˆ‘ä¸æ¨èä½¿ç”¨ã€‚
    
    private static String command = "";
    public static void main(String[] args){
        Thread t1 = new Thread(() -> {
            while (!command.equalsIgnoreCase("exit")) {
                //è¾“å‡º"exit" åœæ­¢çº¿ç¨‹
                System.out.println("ä¸‹è½½ä¸­ï¼");
                try {
                    Thread.sleep(10000);
                } catch (InterruptedException e) {
                }
            }
            System.out.println("æ‰§è¡Œå®Œæˆï¼");

        },"InkHin!");

        t1.start();

        try(InputStreamReader ir = new InputStreamReader(System.in);
            BufferedReader in = new BufferedReader(ir)){

            command = in.readLine();
        } catch(IOException e){}
    }
}
```

## çº¿ç¨‹å®‰å…¨

åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œè®¿é—®ç›¸åŒçš„èµ„æºï¼Œå°±æœ‰å¯èƒ½å¼•å‘çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ã€‚

### å…±äº«èµ„æº

å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œæœ‰æ—¶çº¿ç¨‹ä¹‹é—´éœ€è¦å…±äº«æ•°æ®ï¼Œä¸€ä¸ªçº¿ç¨‹éœ€è¦å…¶ä»–çº¿ç¨‹çš„æ•°æ®ï¼Œå¦åˆ™å°±ä¸èƒ½ä¿è¯ç¨‹åºè¿è¡Œç»“æœçš„æ­£ç¡®æ€§ã€‚

ä»¥è¿™ä¸ªæ¨¡æ‹Ÿé”€å”®æœºç¥¨ç³»ç»Ÿä¸ºä¾‹,

```Java
public class TicketDB {
    // æœºç¥¨çš„æ•°é‡
    private int ticketCount = 5;
    // è·å¾—å½“å‰æœºç¥¨æ•°é‡
    public int getTicketCount() {
        return ticketCount;
    }
    // é”€å”®æœºç¥¨
    public void sellTicket() {
        try {
            // ç­‰äºç”¨æˆ·ä»˜æ¬¾
            // çº¿ç¨‹ä¼‘çœ ï¼Œé˜»å¡å½“å‰çº¿ç¨‹ï¼Œæ¨¡æ‹Ÿç­‰å¾…ç”¨æˆ·ä»˜æ¬¾
            Thread.sleep(1000);
        } catch (InterruptedException e) {
        }
        System.out.printf("ç¬¬%då·ç¥¨,å·²ç»å”®å‡º\n", ticketCount);
        ticketCount--;
    }
}
```

```Java
public static void main(String[] args) {
        TicketDB db = new TicketDB();
        // åˆ›å»ºçº¿ç¨‹t1
        Thread t1 = new Thread(() -> {
            while (true) {
                int currTicketCount = db.getTicketCount();
                // æŸ¥è¯¢æ˜¯å¦æœ‰ç¥¨
                if (currTicketCount > 0) {
                    db.sellTicket();
                } else {
                    // æ— ç¥¨é€€å‡º
                    break;
                }
            }
        });
        // å¼€å§‹çº¿ç¨‹t1
        t1.start();
        // åˆ›å»ºçº¿ç¨‹t2
        Thread t2 = new Thread(() -> {
            while (true) {
                int currTicketCount = db.getTicketCount();
                // æŸ¥è¯¢æ˜¯å¦æœ‰ç¥¨
                if (currTicketCount > 0) {
                    db.sellTicket();
                } else {
                    // æ— ç¥¨é€€å‡º
                    break;
                }
            }
        });
        // å¼€å§‹çº¿ç¨‹t2
        t2.start();
    }
```

è¿è¡Œä»¥åï¼Œæœ‰æ—¶ä¼šå‡ºç°é‡å¤ç¥¨å·ï¼Œç”šè‡³ä¼šå‡ºç°ç¬¬0å·ç¥¨ï¼Œè¿™äº›é—®é¢˜éƒ½æ˜¯å¤šä¸ªçº¿ç¨‹é—´å…±äº«çš„æ•°æ®å¯¼è‡´æ•°æ®ä¸ä¸€è‡´é€ æˆçš„ã€‚

### å¤šçº¿ç¨‹åŒæ­¥

ä¸ºäº†è§£å†³ä¸Šé¢è¿™ç§å®‰å…¨é—®é¢˜ï¼ŒJavaæä¾›äº†â€œäº’æ–¥â€æœºåˆ¶ï¼Œå¯ä»¥ä¸ºè¿™äº›èµ„æºå¯¹è±¡åŠ ä¸Šä¸€æŠŠâ€œäº’æ–¥é”â€ï¼Œåœ¨ä»»ä¸€æ—¶åˆ»åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œå³ä½¿è¯¥çº¿ç¨‹å‡ºç°é˜»å¡ï¼Œè¯¥å¯¹è±¡çš„è¢«é”å®šçŠ¶æ€ä¹Ÿä¸ä¼šè¢«è§£é™¤ï¼Œå…¶ä»–çº¿ç¨‹ä»ä¸èƒ½è®¿é—®è¯¥å¯¹è±¡ï¼Œè¿™å°±æ˜¯å¤šçº¿ç¨‹åŒæ­¥ã€‚

å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å®ç°çº¿ç¨‹åŒæ­¥ï¼Œä¸¤ç§æ–¹å¼éƒ½æ¶‰åŠä½¿ç”¨`synchronized`å…³é”®å­—ï¼Œä¸€ç§æ˜¯`synchronized`æ–¹æ³•ï¼Œä½¿ç”¨`synchronized`å…³é”®å­—ä¿®é¥°æ–¹æ³•ï¼Œå¯¹æ–¹æ³•è¿›è¡ŒåŒæ­¥ï¼›å¦ä¸€ç§æ˜¯`synchronized`è¯­å¥ï¼Œå°†`synchronized`å…³é”®å­—æ”¾åœ¨å¯¹è±¡å‰é¢é™åˆ¶ä¸€æ®µä»£ç çš„æ‰§è¡Œã€‚

```java
//å¤šçº¿ç¨‹åŒæ­¥ æ–¹æ³•ä¸€
public class TicketDB {
    private int ticketCount = 5; //æœºç¥¨æ•°é‡
    //è·å–å½“å‰æœºç¥¨
    public synchronized int getTicketCount(){
        return ticketCount;
    }
    //é”€å”®æœºç¥¨
    public synchronized void sellTicket(){
        try{
            //çº¿ç¨‹ä¼‘çœ  æ¨¡æ‹Ÿç”¨æˆ·ä»˜æ¬¾
            Thread.sleep(1000);

        } catch(InterruptedException e){
        }
        System.out.printf("ç¬¬%då·ç¥¨,å·²ç»å”®å‡º\n",ticketCount);
        ticketCount--;
    }

}
```

```Java
//å¤šçº¿ç¨‹åŒæ­¥ æ–¹æ³•äºŒ
public static void main(String[] args) {
    TicketDB db = new TicketDB();
    Thread t1 = new Thread(() -> {
        while (true) {
            synchronized (db) {
                int currTicketCount = db.getTicketCount();
                if (currTicketCount > 0) {
                    db.sellTicket();
                } else {
                    break;
                }
            }
        }
    }, "çª—å£A");
    t1.start();
    Thread t2 = new Thread(() -> {
        while (true) {
            synchronized (db) {
                int currTicketCount = db.getTicketCount();
                // æŸ¥è¯¢æ˜¯å¦æœ‰ç¥¨
                if (currTicketCount > 0) {
                    db.sellTicket();
                } else {  // æ— ç¥¨é€€å‡º
                    break;
                }
            }
        }
    }, "çª—å£B");
    t2.start();
}
```

## çº¿ç¨‹é—´é€šä¿¡

å¤šçº¿ç¨‹åŒæ­¥çš„åšæ³•åªæ˜¯ç®€å•åœ°ä¸ºç‰¹å®šå¯¹è±¡æˆ–æ–¹æ³•åŠ é”ï¼Œä½†æœ‰æ—¶å€™æƒ…å†µä¼šæ›´åŠ å¤æ‚ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´æœ‰ä¾èµ–å…³ç³»ï¼Œçº¿ç¨‹ä¹‹é—´å¿…é¡»è¿›è¡Œé€šä¿¡ï¼Œäº’ç›¸åè°ƒæ‰èƒ½å®Œæˆå·¥ä½œã€‚

ä»¥ä¸€ä¸ªç»å…¸çš„å †æ ˆé—®é¢˜ä¸ºä¾‹:
ä¸€ä¸ªçº¿ç¨‹ç”Ÿäº§äº†æ•°æ®ï¼Œå°†æ•°æ®å‹æ ˆï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ¶ˆè´¹äº†è¿™äº›æ•°æ®ï¼Œå°†æ•°æ®å‡ºæ ˆã€‚

è¿™ä¸¤ä¸ªçº¿ç¨‹äº’ç›¸ä¾èµ–ï¼Œå½“å †æ ˆä¸ºç©ºï¼Œæ¶ˆè´¹çº¿ç¨‹æ— æ³•å–å‡ºæ•°æ®æ—¶ï¼Œåº”è¯¥å‘Šè¯‰ç”Ÿäº§çº¿ç¨‹å»æ·»åŠ æ•°æ®ï¼›å½“å †æ ˆæ»¡äº†ï¼Œç”Ÿäº§çº¿ç¨‹æ— æ³•æ·»åŠ æ•°æ®æ—¶ï¼Œåº”è¯¥å‘Šè¯‰æ¶ˆè´¹çº¿ç¨‹æ¥å–å‡ºæ•°æ®ã€‚

ä¸ºäº†å®ç°çº¿ç¨‹é—´çš„é€šä¿¡ï¼Œéœ€è¦ä½¿ç”¨Objectç±»å£°æ˜çš„5ä¸ªæ–¹æ³•ï¼›

```Java
void  wait () //ä½¿å½“å‰çº¿ç¨‹é‡Šæ”¾å¯¹è±¡é”ï¼Œç„¶åå½“å‰çº¿ç¨‹å¤„äºå¯¹è±¡ç­‰å¾…é˜Ÿåˆ—ä¸­çš„é˜»å¡çŠ¶æ€ã€‚
void  wait (long timeout) //åŒä¸Šï¼Œç­‰å¾…timeoutæ¯«ç§’
void  wait (long time out,int nanos) //åŒä¸Šï¼Œç­‰å¾…timeoutæ¯«ç§’ åŠ  nanos çº³ç§’
void  notify () //å½“å‰çº¿ç¨‹å”¤é†’æ­¤å¯¹è±¡ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å°†è¿›å…¥å°±ç»ªçŠ¶æ€(start)
void  notifyAll () //å½“å‰çº¿ç¨‹å”¤é†’æ­¤å¯¹è±¡ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹å°†è¿›å…¥å°±ç»ªçŠ¶æ€(start)
```

 ç¤ºä¾‹ï¼š

```Java
class Stack {
    // å †æ ˆæŒ‡é’ˆåˆå§‹å€¼ä¸º0
    private int pointer = 0;
    // å †æ ˆæœ‰5ä¸ªå­—ç¬¦çš„ç©ºé—´
    private char[] data = new char[5];

    // å‹æ ˆæ–¹æ³•ï¼ŒåŠ ä¸Šäº’æ–¥é”
    public synchronized void push(char c) {
        // å †æ ˆå·²æ»¡ï¼Œä¸èƒ½å‹æ ˆ
        while (pointer == data.length) {
            try {
                // ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ•°æ®å‡ºæ ˆ
                this.wait();
            } catch (InterruptedException e) {
            }
        }
        // é€šçŸ¥å…¶å®ƒçº¿ç¨‹æŠŠæ•°æ®å‡ºæ ˆ
        this.notify();
        // æ•°æ®å‹æ ˆ
        data[pointer] = c;
        // æŒ‡é’ˆå‘ä¸Šç§»åŠ¨
        pointer++;
    }

    // å‡ºæ ˆæ–¹æ³•ï¼ŒåŠ ä¸Šäº’æ–¥é”
    public synchronized char pop() {
        // å †æ ˆæ— æ•°æ®ï¼Œä¸èƒ½å‡ºæ ˆ
        while (pointer == 0) {
            try {
                // ç­‰å¾…å…¶å®ƒçº¿ç¨‹æŠŠæ•°æ®å‹æ ˆ
                this.wait();
            } catch (InterruptedException e) {
            }
        }
        // é€šçŸ¥å…¶å®ƒçº¿ç¨‹å‹æ ˆ
        this.notify();
        // æŒ‡é’ˆå‘ä¸‹ç§»åŠ¨
        pointer--;
        // æ•°æ®å‡ºæ ˆ
        return data[pointer];
    }
}
```

```Java
public static void main(String args[]) {
    Stack stack = new Stack();
    // ä¸‹é¢çš„æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…æ‰€æ“ä½œçš„æ˜¯åŒä¸€ä¸ªå †æ ˆå¯¹è±¡stack
    // ç”Ÿäº§è€…çº¿ç¨‹
    Thread producer = new Thread(() -> {
        char c;
        for (int i = 0; i < 10; i++) {
            // éšæœºäº§ç”Ÿ10ä¸ªå­—ç¬¦
            c = (char) (Math.random() * 26 + 'A');
            // æŠŠå­—ç¬¦å‹æ ˆ
            stack.push(c);
            // æ‰“å°å­—ç¬¦
            System.out.println("ç”Ÿäº§: " + c);
            try {
                // æ¯äº§ç”Ÿä¸€ä¸ªå­—ç¬¦çº¿ç¨‹å°±ç¡çœ 
                Thread.sleep((int) (Math.random() * 1000));
            } catch (InterruptedException e) {
            }
        }

    });
    // æ¶ˆè´¹è€…çº¿ç¨‹
    Thread consumer = new Thread(() -> {
        char c;
        for (int i = 0; i < 10; i++) {
            // ä»å †æ ˆä¸­è¯»å–å­—ç¬¦
            c = stack.pop();
            // æ‰“å°å­—ç¬¦
            System.out.println("æ¶ˆè´¹: " + c);
            try {
                // æ¯è¯»å–ä¸€ä¸ªå­—ç¬¦çº¿ç¨‹å°±ç¡çœ 
                Thread.sleep((int) (Math.random() * 1000));
            } catch (InterruptedException e) {
            }
        }

    });
    producer.start(); // å¯åŠ¨ç”Ÿäº§è€…çº¿ç¨‹
    consumer.start(); // å¯åŠ¨æ¶ˆè´¹è€…çº¿ç¨‹
}
```